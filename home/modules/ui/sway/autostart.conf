# home/modules/sway/autostart.conf

# --- 1. Portal & Environment Setup (Keep this! It fixes the wallpaper script too) ---
# Kill any existing portals to clear the state
exec killall -q xdg-desktop-portal xdg-desktop-portal-wlr xdg-desktop-portal-gtk

# Upload variables to systemd & dbus
# This ensures Kanshi and your Wallpaper script can find SWAYSOCK and WAYLAND_DISPLAY
exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
exec hash dbus-update-activation-environment 2>/dev/null && \
     dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP

# Restart the portal service
exec systemctl --user restart xdg-desktop-portal

# --- 2. Fixes & Tweaks ---
# Force focus to Workspace 1 on boot (Fixes closed-lid startup focus)
exec swaymsg workspace 1

# Trigger Wallpaper Script immediately on startup/reload
exec_always $wallpaper

# --- Activate when using quickshell ---
# exec_always sh -c "pkill -f 'shell.qm[l]'; while pgrep -f 'shell.qm[l]' >/dev/null; do sleep 0.1; done; ~/.nix-profile/bin/quickshell > /tmp/quickshell.log 2>&1 &"

# --- Activate when using Waybar ---
exec_always sh -c "pkill waybar; waybar"

