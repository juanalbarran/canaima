# home/modules/sway/autostart.conf

# --- 1. Portal & Environment Setup (Keep this! It fixes the wallpaper script too) ---
# Kill any existing portals to clear the state
exec killall -q xdg-desktop-portal xdg-desktop-portal-wlr xdg-desktop-portal-gtk

# Upload variables to systemd & dbus
# This ensures Kanshi and your Wallpaper script can find SWAYSOCK and WAYLAND_DISPLAY
exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
exec hash dbus-update-activation-environment 2>/dev/null && \
     dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP

# Restart the portal service
exec systemctl --user restart xdg-desktop-portal

# --- 2. Fixes & Tweaks ---
# Force focus to Workspace 1 on boot (Fixes closed-lid startup focus)
exec swaymsg workspace 1

# Trigger Wallpaper Script immediately on startup/reload
exec_always systemctl --user start wallpaper-cycler.service
exec_always pkill quickshell; ~/.nix-profile/bin/quickshell

# --- 3. Idle / Lock Screen ---
# I uncommented this so your lock screen works.
# If you don't want it yet, you can comment it back out.
#exec swayidle -w \
#     timeout 300 'hyprlock' \
#     timeout 600 'swaymsg "output * power off"' \
#     resume 'swaymsg "output * power on"' \
#     before-sleep 'hyprlock'

