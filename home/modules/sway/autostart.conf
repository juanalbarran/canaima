# home/modules/sway/autostart.conf

# XDG Desktop Portal for wlroots-based compositors
#exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
#exec systemctl --user start xdg-desktop-portal xdg-desktop-portal-wlr
#exec dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP

# home/modules/sway/autostart.conf

# 1. Kill any existing portals (Clears the state from the login screen)
exec killall -q xdg-desktop-portal xdg-desktop-portal-wlr xdg-desktop-portal-gtk

# 2. Upload variables to systemd & dbus (Crucial Fix)
exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP
exec hash dbus-update-activation-environment 2>/dev/null && \
     dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK XDG_CURRENT_DESKTOP

# 3. Reload the systemd service to pick up the changes
# We restart the main portal service; it will automatically launch the correct backend (wlr or gtk) based on the config we just made.
exec systemctl --user restart xdg-desktop-portal

# exec swayidle -w \
#     timeout 300 'hyprlock' \
#     timeout 600 'swaymsg "output * power off"' \
#     resume 'swaymsg "output * power on"' \
#     before-sleep 'hyprlock'
